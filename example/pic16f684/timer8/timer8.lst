gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  1


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00001 ; ***********************************************************
               00002 ;
               00003 ; file: timer8.asm
               00004 ; target: PIC16f684 on PICKit 1
               00005 ; author: David Henry
               00006 ; licence: This program is licensed under the terms of the
               00007 ;          MIT licence.  You can get a copy of it at:
               00008 ;     http://www.opensource.org/licenses/mit-license.php
               00009 ;
               00010 ; This program makes lighting LEDs D0 to D7 one by one.
               00011 ; 16-bit Timer1 is used for waiting before switching to the
               00012 ; next LED.
               00013 ;
               00014 ; ***********************************************************
               00015 
               00016         ; use PIC 16F684
               00017         list            p=16f684
               00018         #include        <p16f684.inc>
               00001         LIST
               00002 ; P16F684.INC  Standard Header File, Version 1.03    Microchip Technology, Inc.
               00379         LIST
               00019 
               00020         ; set configuration word.
002007 30D4    00021         __CONFIG        _FCMEN_OFF & _IESO_OFF & _BOD_OFF & _CPD_OFF & _CP_OFF & _MCLRE_OFF & _PWRTE_OFF & _WDT_OFF & _INTRC_OSC_NOCLKOUT
               00022 
               00023         ; hide warning message 302:
               00024         ; "Register in operand not in bank 0. Ensure bank bits are correct."
               00025         errorlevel      -302
               00026 
               00027         ; -------------------------------------------------------
               00028         ; global variable declarations.
               00029         ; -------------------------------------------------------
               00030 
  00000020     00031 ledn            equ     0x20
  00000021     00032 index           equ     0x21
               00033 
  00000070     00034 status_temp     equ     0x70
  00000071     00035 w_temp          equ     0x71
               00036 
               00037         ; -------------------------------------------------------
               00038         ; reset vector.  this is where the PCL is set after
               00039         ; power on and reset.
               00040         ; -------------------------------------------------------
               00041 
0000           00042         org     0x00
0000 2833      00043         goto    main
               00044 
               00045         ; -------------------------------------------------------
               00046         ; interrupt vector.  this is where the PCL is set after
               00047         ; an interruption occured.
               00048         ; -------------------------------------------------------
               00049 
0004           00050         org     0x04
0004 00F1      00051         movwf   w_temp
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  2


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
0005 0E03      00052         swapf   STATUS,W
0006 0183      00053         clrf    STATUS
0007 00F0      00054         movwf   status_temp
               00055 
               00056 ;       bcf     STATUS,RP0      ; enter bank 0
0008 180C      00057         btfsc   PIR1,0          ; test if timer1 overflowed (TMR1IF)
0009 280B      00058         goto    tmr1_isr
               00059 
000A 2811      00060         goto    end_isr
               00061 
000B           00062 tmr1_isr
               00063         ; -------------------------------------------------------
               00064         ; timer1 interruption service request.
               00065         ; -------------------------------------------------------
               00066 
000B 0AA1      00067         incf    index,1         ; increment LED number
000C 19A1      00068         btfsc   index,3         ; if index = 8,
000D 01A1      00069         clrf    index           ;  index := 0
               00070 
000E 018C      00071         clrf    PIR1            ; clear interrupt flag
               00072 
000F 0821      00073         movf    index,w         ; light on the LED number 'index'
0010 2028      00074         call    led_on
               00075 
0011           00076 end_isr
0011 0E70      00077         swapf   status_temp,w
0012 0083      00078         movwf   STATUS
0013 0EF1      00079         swapf   w_temp,f
0014 0E71      00080         swapf   w_temp,w
0015 0009      00081         retfie
               00082 
0016           00083 config_led
               00084         ; -------------------------------------------------------
               00085         ; LED configuration.  return into W the TRISA
               00086         ; configuration for lighting the proper LED.  before
               00087         ; calling this function, W must contain the LED number
               00088         ; (from 0 to 7) we want to light on.
               00089         ; we use this number as an offset into a table.
               00090         ; -------------------------------------------------------
               00091 
0016 0782      00092         addwf   PCL,f
0017 34CE      00093         retlw   B'11001110'     ; xx00x11x
0018 34CE      00094         retlw   B'11001110'
0019 34EA      00095         retlw   B'11101010'     ; xx10x01x
001A 34EA      00096         retlw   B'11101010'
001B 34DA      00097         retlw   B'11011010'     ; xx01x01x
001C 34DA      00098         retlw   B'11011010'
001D 34F8      00099         retlw   B'11111000'     ; xx11x00x
001E 34F8      00100         retlw   B'11111000'
               00101 
001F           00102 power_led
               00103         ; -------------------------------------------------------
               00104         ; LED powering on.  return into W the PORTA mask for
               00105         ; powering on the proper LED.  before calling this
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  3


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00106         ; function, W must contain the LED number (from 0 to 7)
               00107         ; we want to light on.
               00108         ; we use this number as an offset into a table.
               00109         ; -------------------------------------------------------
               00110 
001F 0782      00111         addwf   PCL,f           ; RA   5 4 2 1
0020 3410      00112         retlw   B'00010000'     ; D0 = 0 1 Z Z
0021 3420      00113         retlw   B'00100000'     ; D1 = 1 0 Z Z
0022 3410      00114         retlw   B'00010000'     ; D2 = Z 1 0 Z
0023 3404      00115         retlw   B'00000100'     ; D3 = Z 0 1 Z
0024 3420      00116         retlw   B'00100000'     ; D4 = 1 Z 0 Z
0025 3404      00117         retlw   B'00000100'     ; D5 = 0 Z 1 Z
0026 3404      00118         retlw   B'00000100'     ; D6 = Z Z 1 0
0027 3402      00119         retlw   B'00000010'     ; D7 = Z Z 0 1
               00120 
0028           00121 led_on
               00122         ; -------------------------------------------------------
               00123         ; light on a LED.  W contains the LED number we want
               00124         ; to enable.
               00125         ; -------------------------------------------------------
               00126 
0028 1283      00127         bcf     STATUS,RP0      ; enter bank 0
0029 00A0      00128         movwf   ledn            ; save LED number to file
               00129 
002A 2016      00130         call    config_led      ; get TRISA value, put it into W
002B 1683      00131         bsf     STATUS,RP0      ; enter bank 1
002C 0085      00132         movwf   TRISA           ; configure I/O
               00133 
002D 1283      00134         bcf     STATUS,RP0      ; enter bank 0
002E 0820      00135         movf    ledn,w          ; restore LED number
               00136 
002F 201F      00137         call    power_led       ; get PORTA value, put it into W
0030 1283      00138         bcf     STATUS,RP0      ; enter bank 0
0031 0085      00139         movwf   PORTA           ; power on the desired LED
0032 0008      00140         return
               00141 
0033           00142 main
               00143         ; -------------------------------------------------------
               00144         ; program's main entry point.
               00145         ; -------------------------------------------------------
               00146 
               00147         ; setup internal clock to 8 MHz
0033 1683      00148         bsf     STATUS,RP0      ; enter bank 1
0034 307E      00149         movlw   0x7e
0035 008F      00150         movwf   OSCCON
               00151 
               00152         ; init LED index
0036 30FF      00153         movlw   0xff            ; first time 'index' will be
0037 00A1      00154         movwf   index           ;  incremented, it will become 0x00
               00155 
               00156         ; init 16-bit timer
0038 1283      00157         bcf     STATUS,RP0      ; enter bank 0
0039 018E      00158         clrf    TMR1L           ; reset timer1 register pair
003A 018F      00159         clrf    TMR1H
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  4


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
               00160 
               00161         ; enable timer interrupts
003B 30C0      00162         movlw   0xc0            ; GIE, PIE
003C 008B      00163         movwf   INTCON
               00164 
003D 1683      00165         bsf     STATUS,RP0      ; enter bank 1
003E 3001      00166         movlw   0x01            ; TMR1IE
003F 008C      00167         movwf   PIE1
               00168 
               00169         ; enable timer1
0040 1283      00170         bcf     STATUS,RP0      ; enter bank 0
0041 3031      00171         movlw   0x31            ; 1:8 prescale value; enable timer1
0042 0090      00172         movwf   T1CON           ;  overflow interrupt
               00173 
0043           00174 loop
               00175         ; -------------------------------------------------------
               00176         ; program's main loop.
               00177         ; -------------------------------------------------------
               00178 
0043 2843      00179         goto    loop            ; repeat forever
               00180 
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  5


SYMBOL TABLE
  LABEL                             VALUE 

ADCON0                            0000001F
ADCON1                            0000009F
ADCS0                             00000004
ADCS1                             00000005
ADCS2                             00000006
ADFM                              00000007
ADIE                              00000006
ADIF                              00000006
ADON                              00000000
ADRESH                            0000001E
ADRESL                            0000009E
ANS0                              00000000
ANS1                              00000001
ANS2                              00000002
ANS3                              00000003
ANS4                              00000004
ANS5                              00000005
ANS6                              00000006
ANS7                              00000007
ANSEL                             00000091
C                                 00000000
C1IE                              00000003
C1IF                              00000003
C1INV                             00000004
C1OUT                             00000006
C2IE                              00000004
C2IF                              00000004
C2INV                             00000005
C2OUT                             00000007
C2SYNC                            00000000
CCP1CON                           00000015
CCP1IE                            00000005
CCP1IF                            00000005
CCP1M0                            00000000
CCP1M1                            00000001
CCP1M2                            00000002
CCP1M3                            00000003
CCPR1H                            00000014
CCPR1L                            00000013
CHS0                              00000002
CHS1                              00000003
CHS2                              00000004
CIS                               00000003
CM0                               00000000
CM1                               00000001
CM2                               00000002
CMCON0                            00000019
CMCON1                            0000001A
DC                                00000001
DC1B0                             00000004
DC1B1                             00000005
ECCPAS                            00000017
ECCPAS0                           00000004
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  6


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
ECCPAS1                           00000005
ECCPAS2                           00000006
ECCPASE                           00000007
EEADR                             0000009B
EECON1                            0000009C
EECON2                            0000009D
EEDAT                             0000009A
EEDATA                            0000009A
EEIE                              00000007
EEIF                              00000007
F                                 00000001
FSR                               00000004
GIE                               00000007
GO                                00000001
GO_DONE                           00000001
HTS                               00000002
INDF                              00000000
INTCON                            0000000B
INTE                              00000004
INTEDG                            00000006
INTF                              00000001
IOC                               00000096
IOC0                              00000000
IOC1                              00000001
IOC2                              00000002
IOC3                              00000003
IOC4                              00000004
IOC5                              00000005
IOCA                              00000096
IOCA0                             00000000
IOCA1                             00000001
IOCA2                             00000002
IOCA3                             00000003
IOCA4                             00000004
IOCA5                             00000005
IRCF0                             00000004
IRCF1                             00000005
IRCF2                             00000006
IRP                               00000007
LTS                               00000001
NOT_BOD                           00000000
NOT_DONE                          00000001
NOT_PD                            00000003
NOT_POR                           00000001
NOT_RAPU                          00000007
NOT_T1SYNC                        00000002
NOT_TO                            00000004
OPTION_REG                        00000081
OSCCON                            0000008F
OSCTUNE                           00000090
OSFIE                             00000002
OSFIF                             00000002
OSTS                              00000003
P1M0                              00000006
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  7


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
P1M1                              00000007
PCL                               00000002
PCLATH                            0000000A
PCON                              0000008E
PDC0                              00000000
PDC1                              00000001
PDC2                              00000002
PDC3                              00000003
PDC4                              00000004
PDC5                              00000005
PDC6                              00000006
PEIE                              00000006
PIE1                              0000008C
PIR1                              0000000C
PORTA                             00000005
PORTC                             00000007
PR2                               00000092
PRSEN                             00000007
PS0                               00000000
PS1                               00000001
PS2                               00000002
PSA                               00000003
PSSAC0                            00000002
PSSAC1                            00000003
PSSBD0                            00000000
PSSBD1                            00000001
PWM1CON                           00000016
RAIE                              00000003
RAIF                              00000000
RD                                00000000
RP0                               00000005
RP1                               00000006
SBODEN                            00000004
SCS                               00000000
STATUS                            00000003
SWDTEN                            00000000
T0CS                              00000005
T0IE                              00000005
T0IF                              00000002
T0SE                              00000004
T1CKPS0                           00000004
T1CKPS1                           00000005
T1CON                             00000010
T1GINV                            00000007
T1GSS                             00000001
T1IE                              00000000
T1IF                              00000000
T1OSCEN                           00000003
T2CKPS0                           00000000
T2CKPS1                           00000001
T2CON                             00000012
T2IE                              00000001
T2IF                              00000001
TMR0                              00000001
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  8


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
TMR1CS                            00000001
TMR1GE                            00000006
TMR1H                             0000000F
TMR1IE                            00000000
TMR1IF                            00000000
TMR1L                             0000000E
TMR1ON                            00000000
TMR2                              00000011
TMR2IE                            00000001
TMR2IF                            00000001
TMR2ON                            00000002
TOUTPS0                           00000003
TOUTPS1                           00000004
TOUTPS2                           00000005
TOUTPS3                           00000006
TRISA                             00000085
TRISC                             00000087
TUN0                              00000000
TUN1                              00000001
TUN2                              00000002
TUN3                              00000003
TUN4                              00000004
ULPWUE                            00000005
VCFG                              00000006
VR0                               00000000
VR1                               00000001
VR2                               00000002
VR3                               00000003
VRCON                             00000099
VREN                              00000007
VRR                               00000005
W                                 00000000
WDTCON                            00000018
WDTPS0                            00000001
WDTPS1                            00000002
WDTPS2                            00000003
WDTPS3                            00000004
WPU                               00000095
WPUA                              00000095
WR                                00000001
WREN                              00000002
WRERR                             00000003
Z                                 00000002
_BOD_NSLEEP                       00003EFF
_BOD_OFF                          00003CFF
_BOD_ON                           00003FFF
_BOD_SBODEN                       00003DFF
_CPD_OFF                          00003FFF
_CPD_ON                           00003F7F
_CP_OFF                           00003FFF
_CP_ON                            00003FBF
_EC_OSC                           00003FFB
_EXTRC                            00003FFF
_EXTRCIO                          00003FFE
gpasm-0.13.3 beta               timer8.asm  9-2-2006  17:59:46           PAGE  9


LOC  OBJECT CODE     LINE SOURCE TEXT
  VALUE
 
_EXTRC_OSC_CLKOUT                 00003FFF
_EXTRC_OSC_NOCLKOUT               00003FFE
_FCMEN_OFF                        000037FF
_FCMEN_ON                         00003FFF
_HS_OSC                           00003FFA
_IESO_OFF                         00003BFF
_IESO_ON                          00003FFF
_INTOSC                           00003FFD
_INTOSCIO                         00003FFC
_INTRC_OSC_CLKOUT                 00003FFD
_INTRC_OSC_NOCLKOUT               00003FFC
_LP_OSC                           00003FF8
_MCLRE_OFF                        00003FDF
_MCLRE_ON                         00003FFF
_PWRTE_OFF                        00003FFF
_PWRTE_ON                         00003FEF
_WDT_OFF                          00003FF7
_WDT_ON                           00003FFF
_XT_OSC                           00003FF9
__16F684                          00000001
config_led                        00000016
end_isr                           00000011
index                             00000021
led_on                            00000028
ledn                              00000020
loop                              00000043
main                              00000033
power_led                         0000001F
status_temp                       00000070
tmr1_isr                          0000000B
w_temp                            00000071


MEMORY USAGE MAP ('X' = Used,  '-' = Unused)

00000000 : X---XXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX XXXXXXXXXXXXXXXX
00000040 : XXXX------------ ---------------- ---------------- ----------------
00002000 : -------X-------- ---------------- ---------------- ----------------

All other memory blocks unused.

Program Memory Words Used: 66


Errors   :       0
Warnings :       0 reported,       0 suppressed
Messages :       0 reported,       3 suppressed

